#
# Test default behavior of rtorrent in various network setttings.
#

rdo_test_begin

#
# Public torrents:
#

rdo_stage_network "rt-network-global"

rdo_stage_tracker --run-template "tracker-default" --network "rt-network-global" "rt-tracker-public-1"

rdo_stage_torrent --domain "rt-tracker-public-1.rt-network-global" "torrent-public-1"

rdo_stage_rtorrent --run-template "rt-default" --network "rt-network-global" "rt-seed-public-1"
rdo_stage_rtorrent --run-template "rt-default" --network "rt-network-global" "rt-leech-public-1"

rdo_torrent_node --node "rt-seed-public-1"  --seed "torrent-public-1"
rdo_torrent_node --node "rt-leech-public-1"        "torrent-public-1"

#
# Leecher behind a NAT:
#

rdo_stage_network "rt-network-nat-1"

rdo_stage_router --network "rt-network-global" --network "rt-network-nat-1" "rt-router-nat-1"

rdo_stage_rtorrent --run-template "rt-default" --network "rt-network-nat-1" "rt-leech-public-1"

rdo_torrent_node --node "rt-leech-nat-1" "torrent-public-1"

#
# Deploy:
#

rdo_stage_deploy

rdo_torrent_wait --print --wait-all \
                 \
                 --hash-done     "rt-seed-public-1:torrent-public-1" \
                 --not-completed "rt-seed-public-1:torrent-public-1" \
                 --seeding       "rt-seed-public-1:torrent-public-1" \
                 \
                 --hash-done     "rt-leech-public-1:torrent-public-1" \
                 --completed     "rt-leech-public-1:torrent-public-1" \
                 --seeding       "rt-leech-public-1:torrent-public-1"

rdo_test_end
